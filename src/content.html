<div class="article-entry" itemprop="articleBody">
  <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2>
  <p>很早之前就关注过docker，看过有关的资料，但是那时候docker并不支持window，使用需要使用 <code>docker toolbox</code>
    采用<code>VirtualBox</code>虚拟机的方式来安装，觉得很麻烦，就一直没有尝试。 </p>
  <p>最近无意中发现<code>docker for window</code>发布了，可以在win10上使用，趁着最近不忙，倒腾一下。<br><a id="more"></a></p>
  <h2 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h2>
  <p><code>docker for window</code> 跟 <code>docker toolbox</code> 不同，<code>docker for window</code>
    依赖与微软的虚拟化技术<code>Hyper V</code>。所以我们首先要开启win10的<code>Hyper V</code>:<br>通过控制面板的<code>程序和功能</code> -&gt;
    <code>启用和关闭Windows</code>功能查看 Hyper V 状态：</p>
  <p><img src="//ohm2ny54m.qnssl.com/blog/20180928163323.jpg" alt="image"> </p>
  <p>安装非常简单，下载 <a href="https://note.youdao.com/" target="_blank" rel="noopener">docker for window</a> 下一步安装就OK了 </p>
  <p>安装完成以后执行 <code>docker version</code> 查看安装结果</p>
  <pre><span class="line"><span class="string">$</span> <span class="string">docker</span> <span class="string">version</span></span><br><span class="line"><span class="attr">Client:</span></span><br><span class="line"><span class="attr"> Version:</span>           <span class="number">18.06</span><span class="number">.1</span><span class="bullet">-ce</span></span><br><span class="line"> <span class="string">API</span> <span class="attr">version:</span>       <span class="number">1.38</span></span><br><span class="line"> <span class="string">Go</span> <span class="attr">version:</span>        <span class="string">go1.10.3</span></span><br><span class="line"> <span class="string">Git</span> <span class="attr">commit:</span>        <span class="string">e68fc7a</span></span><br><span class="line"><span class="attr"> Built:</span>             <span class="string">Tue</span> <span class="string">Aug</span> <span class="number">21</span> <span class="number">17</span><span class="string">:21:34</span> <span class="number">2018</span></span><br><span class="line"> <span class="string">OS/Arch:</span>           <span class="string">windows/amd64</span></span><br><span class="line"><span class="attr"> Experimental:</span>      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Server:</span></span><br><span class="line"><span class="attr"> Engine:</span></span><br><span class="line"><span class="attr">  Version:</span>          <span class="number">18.06</span><span class="number">.1</span><span class="bullet">-ce</span></span><br><span class="line">  <span class="string">API</span> <span class="attr">version:</span>      <span class="number">1.38</span> <span class="string">(minimum</span> <span class="string">version</span> <span class="number">1.12</span><span class="string">)</span></span><br><span class="line">  <span class="string">Go</span> <span class="attr">version:</span>       <span class="string">go1.10.3</span></span><br><span class="line">  <span class="string">Git</span> <span class="attr">commit:</span>       <span class="string">e68fc7a</span></span><br><span class="line"><span class="attr">  Built:</span>            <span class="string">Tue</span> <span class="string">Aug</span> <span class="number">21</span> <span class="number">17</span><span class="string">:29:02</span> <span class="number">2018</span></span><br><span class="line">  <span class="string">OS/Arch:</span>          <span class="string">linux/amd64</span></span><br><span class="line"><span class="attr">  Experimental:</span>     <span class="literal">false</span></span><br></pre>

  <h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2>
  <p>记录一些常用命令，其他的可以执行 <code>docker --help</code> 查看</p>
  <pre><span class="line"><span class="comment">// 下载image</span></span><br><span class="line">docker pull ubuntu </span><br><span class="line"></span><br><span class="line"><span class="comment">//查看已下载image</span></span><br><span class="line">docker <span class="built_in">image</span> ls </span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除image</span></span><br><span class="line">docker <span class="built_in">image</span> rm &lt;imageName&gt;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行</span></span><br><span class="line">docker <span class="built_in">run</span> ubuntu --name ubuntu </span><br><span class="line"><span class="comment">// 使用ubuntu image 创建一个container 并设置名字为 ubuntu</span></span><br><span class="line"><span class="comment">// 运行时会检测系统中有没有该image如果没有会自动调用`docker pull unbutu`下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看run参数</span></span><br><span class="line">docker <span class="built_in">run</span> --help</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止ubuntu</span></span><br><span class="line">docker <span class="built_in">stop</span> ubuntu  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 进入容器</span></span><br><span class="line">docker <span class="built_in">attach</span> ubuntu</span><br></pre>

  <h2 id="配置vue开发环境"><a href="#配置vue开发环境" class="headerlink" title="配置vue开发环境"></a>配置vue开发环境</h2>
  <h4 id="1-查看可用image"><a href="#1-查看可用image" class="headerlink"
      title="1. 查看可用image"></a>1. 查看可用image</h4>
  <pre><code>![ebiven/vue-cli](//ohm2ny54m.qnssl.com/blog/20180928165947.jpg)

这里我们采用 [ebiven/vue-cli](https://hub.docker.com/r/ebiven/vue-cli/)  

&gt; 如果没有满足自己需求的image，也可以自己制作，这个下次再说
</code></pre>
  <h4 id="2-下载-image"><a href="#2-下载-image" class="headerlink" title="2. 下载 image"></a>2. 下载 image</h4>
  
  <pre><span class="line">docker pull ebiven/vue-<span class="keyword">cli</span></span><br></pre>

  <h4 id="3-配置命令"><a href="#3-配置命令" class="headerlink" title="3. 配置命令"></a>3. 配置命令</h4>
  众所周知，window下的命令行工具不太好用，为了便于操作，我这里使用cmder作为命令行工具  image说明文件中的命令是linux下的命令，在window下执行会出错：

  <pre><span class="line">$ docker <span class="keyword">run</span><span class="bash"> -it --rm -v <span class="string">"<span class="variable">$PWD</span>"</span>:<span class="string">"<span class="variable">$PWD</span>"</span> -w <span class="string">"<span class="variable">$PWD</span>"</span>  -u <span class="string">"<span class="variable">$(id -u)</span>"</span> ebiven/vue-cli vue</span></span><br><span class="line"><span class="bash">docker: Error response from daemon: the working directory <span class="string">'$PWD'</span> is invalid, it needs to be an absolute path.</span></span><br><span class="line"><span class="bash">See <span class="string">'docker run --help'</span>.</span></span><br></pre>

  在window下需要使用 `%cd%` 输出当前目录，如下：
  <pre><span class="line">docker run -it <span class="params">--rm</span> -v <span class="string">"%cd%"</span>:<span class="string">/code</span> -w <span class="string">/code</span> -p 8080<span class="function">:8080</span> ebiven/vue-cli vue</span><br><span class="line"><span class="string">//</span> -it: 进行交互式操作</span><br><span class="line"><span class="string">//</span> <span class="params">--rm</span>：关闭该 container 后删除文件</span><br><span class="line"><span class="string">//</span> -v %<span class="keyword">cd</span>%:<span class="string">/code</span>: 将执行命令的目录映射到container的<span class="string">/code</span>目录</span><br><span class="line"><span class="string">//</span> -w <span class="string">/code</span>: 设置命令执行目录为<span class="string">/code</span></span><br><span class="line"><span class="string">//</span> -p 8080<span class="function">:8080</span>：将本机的8080端口映射为container的8080端口</span><br></pre>
  
  测试一下：
  <pre><span class="line">$ docker run -it <span class="params">--rm</span> -v <span class="string">"%cd%"</span>:<span class="string">/code</span> -w <span class="string">/code</span> ebiven/vue-cli vue <span class="params">--version</span></span><br><span class="line">3.0.1</span><br></pre>
 

  执行成功！
  
  新建一个项目试试：
  <pre><span class="line">$ docker run -it <span class="comment">--rm -v "%cd%":/code -w /code ebiven/vue-cli vue create test</span></span><br><span class="line"></span><br><span class="line">Vue CLI v3.0.1</span><br><span class="line">? Please pick a preset: default (babel, eslint)</span><br><span class="line">? Pick the package manager to <span class="keyword">use</span> <span class="keyword">when</span> installing dependencies: Yarn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue CLI v3<span class="number">.0</span><span class="number">.1</span></span><br><span class="line">✨  Creating <span class="keyword">project</span> <span class="keyword">in</span> /code/test.</span><br><span class="line">⚙  Installing CLI plugins. This might take a while...</span><br><span class="line"></span><br><span class="line">yarn <span class="keyword">install</span> v1<span class="number">.9</span><span class="number">.2</span></span><br><span class="line">info <span class="keyword">No</span> lockfile found.</span><br><span class="line">[<span class="number">1</span>/<span class="number">4</span>] Resolving packages...</span><br><span class="line">[<span class="number">2</span>/<span class="number">4</span>] Fetching packages...</span><br><span class="line">[<span class="comment">--------------------------------------------------------------------------------------------------------------------------] 0/1041(node:23) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.</span></span><br><span class="line">info fsevents@<span class="number">1.2</span><span class="number">.4</span>: The platform <span class="string">"linux"</span> <span class="keyword">is</span> incompatible <span class="keyword">with</span> this module.</span><br><span class="line">info <span class="string">"fsevents@1.2.4"</span> <span class="keyword">is</span> an optional dependency <span class="keyword">and</span> <span class="keyword">failed</span> <span class="keyword">compatibility</span> check. <span class="keyword">Excluding</span> it <span class="keyword">from</span> installation.</span><br><span class="line">[<span class="number">3</span>/<span class="number">4</span>] Linking dependencies...</span><br><span class="line">[<span class="number">4</span>/<span class="number">4</span>] Building <span class="keyword">fresh</span> packages...</span><br><span class="line"><span class="keyword">success</span> Saved lockfile.</span><br><span class="line">info <span class="keyword">To</span> <span class="keyword">upgrade</span>, run the <span class="keyword">following</span> command:</span><br><span class="line">$ curl <span class="comment">--compressed -o- -L https://yarnpkg.com/install.sh | bash</span></span><br><span class="line">Done <span class="keyword">in</span> <span class="number">162.74</span>s.</span><br><span class="line">🚀  Invoking generators...</span><br><span class="line">📦  Installing additional dependencies...</span><br><span class="line"></span><br><span class="line">yarn <span class="keyword">install</span> v1<span class="number">.9</span><span class="number">.2</span></span><br><span class="line">[<span class="number">1</span>/<span class="number">4</span>] Resolving packages...</span><br><span class="line">[<span class="number">2</span>/<span class="number">4</span>] Fetching packages...</span><br><span class="line">[<span class="comment">--------------------------------------------------------------------------------------------------------------------------] 0/1045(node:50) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.</span></span><br><span class="line">info fsevents@<span class="number">1.2</span><span class="number">.4</span>: The platform <span class="string">"linux"</span> <span class="keyword">is</span> incompatible <span class="keyword">with</span> this module.</span><br><span class="line">info <span class="string">"fsevents@1.2.4"</span> <span class="keyword">is</span> an optional dependency <span class="keyword">and</span> <span class="keyword">failed</span> <span class="keyword">compatibility</span> check. <span class="keyword">Excluding</span> it <span class="keyword">from</span> installation.</span><br><span class="line">[<span class="number">3</span>/<span class="number">4</span>] Linking dependencies...</span><br><span class="line">[<span class="number">4</span>/<span class="number">4</span>] Building <span class="keyword">fresh</span> packages...</span><br><span class="line"></span><br><span class="line"><span class="keyword">success</span> Saved lockfile.</span><br><span class="line">Done <span class="keyword">in</span> <span class="number">42.59</span>s.</span><br><span class="line">⚓  Running completion hooks...</span><br><span class="line"></span><br><span class="line">📄  Generating README.md...</span><br><span class="line"></span><br><span class="line">🎉  Successfully created <span class="keyword">project</span> test.</span><br><span class="line">👉  <span class="keyword">Get</span> started <span class="keyword">with</span> the <span class="keyword">following</span> commands:</span><br><span class="line"></span><br><span class="line"> $ cd <span class="keyword">test</span></span><br><span class="line"> $ yarn serve</span><br></pre>
  

  安装成功：

  ![安装成功](//ohm2ny54m.qnssl.com/blog/20180928174039.jpg)

  不过，上面的命令也太长了，用起来非常不方便，可以使用`cmder`的别名功能：

  使用`vscode`打开cmder目录下的`config`文件夹下的`user-aliases.cmd`文件，添加如下内容:

  <pre><span class="line"><span class="attribute">node</span>=docker <span class="builtin-name">run</span> -it --rm -v <span class="string">"%cd%"</span>:/code -w /code ebiven/vue-cli node $*</span><br><span class="line"><span class="attribute">vue</span>=docker <span class="builtin-name">run</span> -it --rm -v <span class="string">"%cd%"</span>:/code -w /code -p 8080:8080 ebiven/vue-cli vue $*</span><br><span class="line"><span class="attribute">npm</span>=docker <span class="builtin-name">run</span> -it --rm -v <span class="string">"%cd%"</span>:/code -w /code ebiven/vue-cli npm $*</span><br><span class="line"><span class="attribute">yarn</span>=docker <span class="builtin-name">run</span> -it --rm -v <span class="string">"%cd%"</span>:/code -w /code -p 8080:8080 ebiven/vue-cli yarn $*</span><br><span class="line"><span class="attribute">ubuntu</span>=docker <span class="builtin-name">run</span> -it --rm -v <span class="string">"%cd%"</span>:/code -w /code ebiven/vue-cli bash</span><br></pre>
 

  执行一下 看看效果

  <pre><span class="line">$ <span class="keyword">node</span> <span class="title">--version</span></span><br><span class="line">v10.<span class="number">9.0</span></span><br><span class="line"></span><br><span class="line">$ vue --<span class="keyword">version</span></span><br><span class="line"><span class="number">3.0</span>.<span class="number">1</span></span><br></pre>
 

  搞定！完全看不出来是在docker里面执行的命令。
  </code>
  </pre>
  <h4 id="4-监控文件修改"><a href="#4-监控文件修改" class="headerlink" title="4.  监控文件修改"></a>4. 监控文件修改</h4>
  经过上面的配置，我们就可以在主机上使用喜欢的编辑器编辑代码，通过docker执行。但是使用 `yarn serve` 命令进行开发时，会发现一个问题：在编辑器中编辑文件后，docker无法监听到文件的修改，从而重新编译、刷新页面；我们可以采用 webpack 的轮询功能解决：

在项目根目录创建`vue.config.js`文件:

    <pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line">module.exports = {</span><br><span class="line"><span class="symbol">    devServer:</span> {</span><br><span class="line"><span class="symbol">        watchOptions:</span> {</span><br><span class="line"><span class="symbol">            poll:</span> <span class="number">1000</span>  <span class="comment">//设置轮询时间为1秒</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre>


  再次执行`yarn serve`即可。
 
  <h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>
  <p>经过一天的折腾，基本上搭建好了开发环境，但是并没有正式开始开发，总觉得还有很多坑在等着我；而且使用docker编译vue项目的速度总觉得还不太满意，会不会采用这种开发方式，还得看以后的测试，有兴趣的也可以尝试一下。</p>
</div>